# library-catalog

## Описание
Проект предназначен для управления библиотечным каталогом. Система позволяет управлять информацией о книгах и читателях, а также процессом выдачи и возврата книг, с использованием JWT для аутентификации пользователей (библиотекарей).


#### Установить проект себе можно, прописав команды в командной строке:
- `git clone https://github.com/Anatoliy2610/library-catalog.git`
- `make install` (установятся зависимости из файла requirements.txt)

## Как пользоваться
### Что нужно сделать
- Запуск локального хоста осуществляется командой `make run`.
- Для удобного использования приложения лучше использовать Postman. Это универсальная платформа для работы с API.

### Доступные эндпоинты
#### Пользователи
- `http://127.0.0.1:8000/users` - выводит список всех пользователей
- `http://127.0.0.1:8000/register` - прохождение регистрации
- `http://127.0.0.1:8000/login` - прохождение аутентификации
Для успешной регистрации необходимо отправить POST запрос и добавить в BODY username, email, password в формате JSON.
пример:
```
{
  "username": "string",
  "email": "user@example.com",
  "password": "string"
}
```
Чтобы войти в систему, необходимо отправить POST запрос, добавить в BODY email и password, что указывали при регистрации. На выходе Вы получите Bearer Token, который потребуется для перехода на следующие эндпоинты в Authorization.
#### Книги
- `http://127.0.0.1:8000/books` - выводит список всех книг
- `http://127.0.0.1:8000/book/add` - добавляет новую книгу в базу данных
- `http://127.0.0.1:8000/book/update` - вносит изменения в базе данных по указанной книге
- `http://127.0.0.1:8000/book/delete` - удаляет указанную книгу из базы данных
Эндпоинты защищены JWT токеном, то есть пользователю необходимо аутентифицироваться при помощи Bearer Token.
#### Читатели
- `http://127.0.0.1:8000/readers` - выводит список всех читателей
- `http://127.0.0.1:8000/reader/add` - добавляет читателя в базу данных
- `http://127.0.0.1:8000/reader/update` - вносит изменения в базе данных по указанному читателю
- `http://127.0.0.1:8000/reader/delete` - удаляет указанного читателя из базы данных
Эндпоинты защищены JWT токеном, то есть пользователю необходимо аутентифицироваться при помощи Bearer Token.
#### Выдача и возврат книг
- `http://127.0.0.1:8000/borrows` - выводит список всех выданных книг
- `http://127.0.0.1:8000/borrows/add` - добавляет в базу данных выдачу книги по её id и id читателя. Дата выдачи заносится автоматически.
- `http://127.0.0.1:8000/borrows/remove` - добавляет в базу данных возврат книги по её id и id читателя. Дата возврата заносится автоматически.
- `http://127.0.0.1:8000/borrows/reader/{reader_id}` - выводит список всех выданных книг по id читателя. В {reader_id} необходимо указать id читателя/
Пример: `http://127.0.0.1:8000/borrows/reader/5`

### База данных
В базе данных есть таблицы:
- 'users' хранит в себе информацию о пользователях (библиотекорях);
- 'books' хранит в себе информацию о книгах;
- 'readers' хранит в себе информацию о читателях;
- 'borrowed_books' хранит в себе информацию о выдаче/получении книг читателям.

### Объяснение логики
Реализовать CRUD операции было сложнее с по выдаче/получении книг читателям. В связи с тем, что таблица 'borrowed_books' хранит в себе даты выдачи и приёма книг, сначала было реализованны колонки с хранением данных в формате Date. Решением было использовать встроенную библиотеку datetime и вностить данные в таблицу в формате String.

### Объяснение реализации аутентификации
Хеширование паролей осуществляется при помощи библиотеки passlib. В таблицу 'users' записывает захешированный пароль.
Пользователь(библиотекарь) вводит email и пароль. После пароль при помощи библиотеки passlib проверяется с хешируемым паролем из базы данных, если все данные верно введены, то пользователь получается JWT токен.
При переходе на защищенные эндпоинты, необходимо указывать JWT токен, иначе приложении сообщит о том, что пользователь не вошел в систему. После данный токен проходит проверки по алгоритму HS256, по времени использования токена. Если проверки успешно пройдены, то пользователь получит доступ к защищенной информации.

#### Запустить проверки проекта можно, прописав команды в командной строке:
- `make test` (запускает тестирование)
- `make check` (запускает проверку линтера)
- `make format` (исправляет ошибки линтера)
- `isort app` (исправляет импорты)

### Творческая часть
В проект можно добавить проверку читателей. Например, если читатель повредил книгу или долгое время не возвращал её, то новую книгу читатель не сможет получить. Также можно добавить информацию о состоянии книги, тем самым можно будет отслеживать в каком состоянии читатель вернул книгу.
Реализовать это можно: создать новую таблицу 'condition' в которой будет храниться возможные состояния книги (новая, потрепанная и т.п.). В таблице 'books' добавить новый столбец 'condition_id', который будет связан с 'id' таблицы 'condition' (ForeignKey).
В таблице для читателей 'readers' можно добавить столбец по информации 'status_id', как он относится к книгам. Реализовать это можно путем добавления новой таблицы 'statuses' и связывания 'id' с 'status_id' таблицы 'readers' (ForeignKey).
Добавить эндпоинты:
- CRUD операции по 'statuses'
- CRUD операции по 'condition'
В эндпоинтах внести изменения:
- при добавлении нового читателя автоматически устанавливать его 'status_id'
- при добавлении новой книги указывать её состояние 'condition_id'
- при выдаче книги указывать состояние книги 'condition_id' и производить проверку на статус читателя (можно ли ему выдавать книгу)
- при возврате книги произвести сравнение состояния книги, а также изменения статуса читателя.
